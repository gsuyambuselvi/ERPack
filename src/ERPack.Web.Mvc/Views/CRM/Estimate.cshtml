@using ERPack.Web.Startup
@using ERPack.Web.Models.CRM
@model AddEditEstimateModel
@{
    ViewBag.Title = L("Estimate");
    ViewBag.CurrentPageName = PageNames.CreateEstimate;
}

<section class="content-header">
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-6">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/">Home</a></li>
                        <li class="breadcrumb-item"><a href="/CRM/EstimatesList">Estimates List</a></li>
                        <li class="breadcrumb-item active" aria-current="page">@ViewData["Title"]</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</section>

<section class="content">
    <div class="container-fluid">
        <form id="estimateCreateForm">
            <input id="id" type="hidden" Name="Id" class="form-control" value="@Model.Id">
            <!-- First Section: Cards Side by Side -->
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <!-- Left Card: Estimate Details -->
                        <div class="col-md-6">
                            <div class="p-3 d-flex flex-column">
                                <div class="row">
                                    <div class="col-md-8">
                                        <!-- Estimate ID -->
                                        <div class="form-group col-lg-9">
                                            <label for="EstimateId">Estimate ID</label>
                                            <div class="input-group mb-3">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fas fa-warehouse"></i></span>
                                                </div>
                                                <input type="text" class="form-control" id="EstimateId" value="@Model.EstimateId" name="EstimateId" required readonly>
                                            </div>
                                        </div>

                                        <!-- Description -->
                                        <div class="form-group col-lg-9">
                                            <label for="Description">Description</label>
                                            <div class="input-group mb-3">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fas fa-barcode"></i></span>
                                                </div>
                                                <input type="text" class="form-control" id="Description" name="Description" value="@Model.Description" required>
                                            </div>
                                        </div>
                                        @if (Model.DesignId != null)
                                        {
                                            <input type="hidden" class="form-control" id="designId" name="DesignId" value="@Model.DesignId">
                                            <input type="hidden" class="form-control" id="editIsKit" value="@Convert.ToString(Model.IsKit)">
                                            <input type="hidden" class="form-control" id="editIsIncludeMaterial" value="@Convert.ToString(Model.IsIncludeMaterial)">
                                        }
                                        <!-- Design ID -->
                                        <div class="form-group col-lg-9">
                                            <label for="DesignId">Design ID</label>
                                            <div class="input-group mb-3">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fas fa-warehouse"></i></span>
                                                </div>
                                                <input type="text" class="form-control" id="DesignId" value="@Model.DesignId" required readonly>
                                            </div>
                                        </div>

                                        <!-- Checkboxes -->
                                        <div class="form-group row">
                                            <div class="col-sm-12">
                                                <div class="form-check">
                                                    <input type="checkbox" class="form-check-input" id="asKit" name="asKit">
                                                    <label for="asKit" class="form-check-label">As Kit</label>
                                                </div>
                                                <div class="form-check">
                                                    <input type="checkbox" class="form-check-input" disabled id="includeMaterial" name="includeMaterial">
                                                    <label for="includeMaterial" class="form-check-label">Include Material</label>
                                                </div>
                                                <div class="form-check">
                                                    <input type="checkbox" class="form-check-input" id="includeImage" name="includeImage">
                                                    <label for="includeImage" class="form-check-label">Include Image</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Image Preview Control -->
                                    <div class="col-lg-4 image-container">
                                        <div class="form-group">
                                            <div class="file">
                                                <span> Design</span>
                                                <div id="filePreview" class="border mb-3">
                                                    <input type="hidden" id="hdnDesignImage" name="DesignImage" />

                                                    <img id="designImage" src="" data-filetype="image" data-role="other-image" alt="" style="display:none" />
                                                    <embed id="pdfPreview" src="" data-filetype="pdf" data-role="pdf-image" type="application/pdf" style="display:none" />


                                                    <div id="myModal" class="modal" data-role="modal">
                                                        <span class="close">&times;</span>
                                                        <div class="modal-content">
                                                            <img id="designImagemodal" src="" data-filetype="image" data-role="modal-image" alt="" />
                                                            <embed id="pdfPreviewmodal" src="" data-filetype="pdf" data-role="modal-pdf" type="application/pdf" />
                                                            <input type="range" min="1" max="3" step="0.1" value="1" class="zoom-slider" id="zoomSlider">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2">
                                                    <div class="icon-buttons" id="icon-buttons">
                                                        <button type="button" id="magnify" class="btn btn-outline-primary mx-2" data-role="magnify" disabled>
                                                            <i class="fas fa-search"></i>
                                                        </button>
                                                        <a id="downloadLink" class="btn btn-outline-primary disabled-link" data-role="download-link" href="" download="">
                                                            <i class="fas fa-download"></i>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Card: Customer Details -->
                        <div class="col-md-6">
                            <div class="p-3">
                                <h5>Customer Details</h5>
                                <div class="row">
                                    <label for="customerId" class="col-sm-4 col-form-label">CustomerId</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control-disabled" id="customerId" name="customerId" disabled>
                                        <input type="hidden" id="inpCustomerId" name="CustomerId">
                                    </div>
                                </div>

                                <div class="row">
                                    <label for="customerName" class="col-sm-4 col-form-label">CustomerName</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control-disabled" id="customerName" name="customerName" disabled>
                                    </div>
                                </div>

                                <div class="row">
                                    <label for="customerAddress" class="col-sm-4 col-form-label">@L("Address")</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control-disabled" id="customerAddress" name="customerAddress" disabled>
                                    </div>
                                </div>

                                <div class="row">
                                    <label for="customerPAN" class="col-sm-4 col-form-label">@L("PAN")</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control-disabled" id="customerPAN" name="customerPAN" disabled>
                                    </div>
                                </div>

                                <div class="row">
                                    <label for="customerGST" class="col-sm-4 col-form-label">@L("GSTNo")</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control-disabled" id="customerGST" name="customerGST" disabled>
                                    </div>
                                </div>

                                <div class="row">
                                    <label for="customerEmail" class="col-sm-4 col-form-label">@L("Email")</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control-disabled" id="customerEmail" name="customerEmail" disabled>
                                    </div>
                                </div>

                                <div class="row">
                                    <label for="customerPhone" class="col-sm-4 col-form-label">@L("Phone")</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control-disabled" id="customerPhone" name="customerPhone" disabled>
                                    </div>
                                </div>

                                <div class="row">
                                    <label for="customerWebsite" class="col-sm-4 col-form-label">@L("Website")</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control-disabled" id="customerWebsite" name="customerWebsite" disabled>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr class="custom-divider" />

                    <!-- Second Section: Task Table -->
                    <div class="row">
                        <div class="col-12">
                            <table id="tblTask">
                                <thead>
                                    <tr style="text-align: center;">
                                        <th>Material</th>
                                        <th>Id</th>
                                        <th>Unit</th>
                                        <th>Qty</th>
                                        <th>Price</th>
                                        <th>HSN Code</th>
                                        <th>Discount%</th>
                                        <th>CGST%</th>
                                        <th>SGST%</th>
                                        <th>IGST%</th>
                                        <th>Amount</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr id="taskRow">
                                        <td>
                                            <select class="form-control" id="materialName0" onchange="fnFillMaterialInfo(this)">
                                                <option value="" selected>Select @L("Material")</option>
                                                @if (Model != null && Model.Materials != null)
                                                {
                                                    @foreach (var v in Model.Materials)
                                                    {
                                                        <option value="@v.Id">@v.DisplayName</option>
                                                    }
                                                }
                                            </select>
                                        </td>
                                        <td>
                                            <input type="hidden" id="hdnMaterialId0" name="MaterialId">
                                            <input type="hidden" id="hdnEstimateTaskId0">
                                            <input type="text" id="materialId0" class="form-control" readonly />
                                        </td>
                                        <td>
                                            <input type="hidden" id="unitId0">
                                            <select class="form-control" id="unitName0">
                                                <option value="" selected>Select @L("Unit")</option>
                                                @if (Model != null && Model.Units != null)
                                                {
                                                    @foreach (var v in Model.Units)
                                                    {
                                                        <option value="@v.Id">@v.UnitName</option>
                                                    }
                                                }
                                            </select>
                                        </td>
                                        <td>
                                            <input type="number" id="quantity0" class="form-control" onchange="CalculateTotalAmount()" />
                                        </td>
                                        <td>
                                            <input type="number" id="price0" class="form-control" onchange="CalculateTotalAmount()" />
                                        </td>
                                        <td>
                                            <input type="text" id="hsnCode0" class="form-control" />@* onchange="CalculateTotalAmount()" *@
                                        </td>
                                        <td>
                                            <input type="number" id="discount0" class="form-control" onchange="CalculateTotalAmount()" />
                                        </td>
                                        <td>
                                            <input type="number" id="cGST0" class="form-control" onchange="CalculateTotalAmount()" />
                                        </td>
                                        <td>
                                            <input type="number" id="sGST0" class="form-control" onchange="CalculateTotalAmount()" />
                                        </td>
                                        <td>
                                            <input type="number" id="iGST0" class="form-control" onchange="CalculateTotalAmount()" />
                                        </td>
                                        <td>
                                            <input type="number" id="amount0" class="form-control" />
                                        </td>
                                        <td class="text-center">
                                            <a href="javascript:void(0)"><i class="fas fa-trash" hidden></i></a>
                                        </td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="11" style="text-align: left;">
                                            <input type="button" class="btn btn-primary " id="addRow" value="Add Row" />
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>

                    <!-- Third Section: Total Calculation -->
                    <div class="row text-right">
                        <div class="col-md-12">
                            <div class="row">
                                <div class="col-11" style="font-weight:700;text-align:right;">
                                    Gross Amount :
                                </div>
                                <div id="divGrossAmount" class="col-1" style="font-weight:700;text-align:right;">
                                    0.0
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-11">
                                    CGST :
                                </div>
                                <div id="divCGST" class="col-1">
                                    0.0
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-11">
                                    SGST :
                                </div>
                                <div id="divSGST" class="col-1">
                                    0.0
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-11">
                                    IGST :
                                </div>
                                <div id="divIGST" class="col-1">
                                    0.0
                                </div>
                            </div>

                            <div class="row" style="font-weight:700;text-align:right;">
                                <div class="col-11">
                                    Total :
                                </div>
                                <div id="divTotalAmount" name="TotalAmount" class="col-1" style="font-weight:700;text-align:right;">
                                    0.0
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="card-footer bg-light border-top">
                    <button type="button" class="btn btn-success save-button" onclick="SaveEstimate()">@L("Save")</button>
                    <button type="button" class="btn btn-primary" onclick="ShowPreview()">@L("Preview")</button>
                    <button type="button" class="btn btn-primary" onclick="GeneratePdf()">@L("Pdf")</button>
                    <button type="button" class="btn btn-primary" onclick="SendApprovalEmail()">@L("Email")</button>
                </div>
            </div>
        </form>
    </div>
</section>

@await Html.PartialAsync("~/Views/Shared/Modals/_EstimatePreviewModal.cshtml")

@section scripts
{
    <script src="~/view-resources/Views/CRM/Estimate.js" asp-append-version="true"></script>
    <script src="~/js/typeahead.js/typeahead.bundle.min.js" asp-append-version="true"></script>
    <script src="~/view-resources/Views/_Bundles/imageHelpers.min.js" asp-append-version="true"></script>
}
